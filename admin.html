<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet" />
    <title>Admin Marsaa Showroom</title>
    <style>
      /* Custom CSS for responsiveness */
      @media (max-width: 768px) {
        /* Sidebar */
        #sidebar {
          width: 240px; /* Adjust sidebar width for smaller screens */
        }

        /* Main content */
        .flex-1 {
          padding: 2rem; /* Increase padding for smaller screens */
        }

        /* Product form */
        #productForm {
          max-width: 100%;
        }

        /* Product table */
        #productTableBody img {
          width: 64px; /* Adjust image size in table for smaller screens */
          height: 64px;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 text-black">
    <!-- Navbar -->
    <nav class="bg-gray-300 text-white p-4">
      <div class="container mx-auto flex justify-between items-center">
        <img
          src="https://politekniklp3i-tasikmalaya.ac.id/assets/lp3i-36503943.svg"
          alt="logo politekniklp3i-tasikmalaya"
          class="h-10 w-auto mx-auto"
        />
        <button id="toggleSidebar" class="text-white focus:outline-none">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            ></path>
          </svg>
        </button>
      </div>
    </nav>

    <!-- Sidebar -->
    <div
      id="sidebar"
      class="fixed inset-y-0 left-0 bg-gray-800 text-white w-64 transform -translate-x-full transition-transform duration-300"
    >
      <div class="p-4">
        <h2 class="text-xl font-bold mb-6">Navigation</h2>
        <ul>
          <li class="mb-4">
            <a
              href="admin.html"
              class="block py-2 px-4 rounded hover:bg-gray-700"
              >Admin</a
            >
          </li>
          <li class="mb-4">
            <a
              href="index.html"
              class="block py-2 px-4 rounded hover:bg-gray-700"
              >Showcase</a
            >
          </li>
          <li>
            <a
              href="category.html"
              class="block py-2 px-4 rounded hover:bg-gray-700"
              >Categories</a
            >
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-6">
      <!-- Form Tambah Product -->
      <div class="max-w-4xl mx-auto mt-8 bg-white p-8 rounded shadow">
        <h1 class="text-2xl font-bold mb-6">Tambah Product</h1>
        <form id="productForm" class="mb-6">
          <div class="mb-4">
            <label for="productName" class="block text-gray-700 font-bold mb-2"
              >Nama Product</label
            >
            <input
              type="text"
              id="productName"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              required
            />
          </div>
          <div class="mb-4">
            <label for="category" class="block text-gray-700 font-bold mb-2"
              >Category</label
            >
            <div class="flex">
              <select
                id="category"
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                required
              >
                <option value="">Select Category</option>
              </select>
              <button
                type="button"
                id="addCategoryBtn"
                class="ml-2 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
              >
                Add
              </button>
            </div>
          </div>
          <div class="mb-4">
            <label for="description" class="block text-gray-700 font-bold mb-2"
              >Deskripsi</label
            >
            <textarea
              id="description"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              required
            ></textarea>
          </div>
          <div class="mb-4">
            <label for="price" class="block text-gray-700 font-bold mb-2"
              >Harga</label
            >
            <input
              type="number"
              id="price"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              required
            />
          </div>
          <div class="mb-4">
            <label for="motorImage" class="block text-gray-700 font-bold mb-2"
              >Gambar Product (png, jpg, svg)</label
            >
            <input
              type="file"
              id="productImage"
              accept=".png, .jpg, .jpeg, .svg"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              required
            />
          </div>
          <button
            type="submit"
            id="submitButton"
            class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
          >
            Submit
          </button>
        </form>
      </div>

      <!-- Tabel Product -->
      <div class="max-w-4xl mx-auto mt-8 bg-white p-8 rounded shadow">
        <h1 class="text-2xl font-bold mb-6">Tabel Product</h1>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white shadow-md rounded">
            <thead>
              <tr>
                <th
                  class="py-2 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-sm leading-4 font-medium text-gray-600 uppercase tracking-wider"
                >
                  Nama Product
                </th>
                <th
                  class="py-2 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-sm leading-4 font-medium text-gray-600 uppercase tracking-wider"
                >
                  Category Product
                </th>
                <th
                  class="py-2 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-sm leading-4 font-medium text-gray-600 uppercase tracking-wider"
                >
                  Deskripsi
                </th>
                <th
                  class="py-2 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-sm leading-4 font-medium text-gray-600 uppercase tracking-wider"
                >
                  Harga Product
                </th>
                <th
                  class="py-2 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-sm leading-4 font-medium text-gray-600 uppercase tracking-wider"
                >
                  Gambar Product
                </th>
                <th
                  class="py-2 px-4 border-b-2 border-gray-200 bg-gray-100 text-left text-sm leading-4 font-medium text-gray-600 uppercase tracking-wider"
                >
                  Action
                </th>
              </tr>
            </thead>
            <tbody id="productTableBody">
              <!-- Data akan ditambahkan di sini -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Footer -->
      <footer class="bg-gray-800 text-white py-4 mt-8">
        <div class="container mx-auto text-center">
          &copy; 2023 Materi kuliah Front End Development by kanglerian |
          Politeknik LP3I Kampus Tasikmalaya
        </div>
      </footer>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      document
        .getElementById("toggleSidebar")
        .addEventListener("click", function () {
          const sidebar = document.getElementById("sidebar");
          sidebar.classList.toggle("-translate-x-full");
          sidebar.classList.toggle("translate-x-0");
        });

      let editProductId = null;

      document
        .getElementById("productForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const productName = document.getElementById("productName").value;
          const category = document.getElementById("category").value;
          const description = document.getElementById("description").value;
          const price = document.getElementById("price").value;
          const productImage = document.getElementById("productImage").files[0];

          if (
            productName &&
            category &&
            description &&
            price &&
            (productImage || editProductId)
          ) {
            const reader = new FileReader();

            reader.onload = async function (e) {
              try {
                if (editProductId) {
                  await axios.put(
                    `http://localhost:3000/products/${editProductId}`,
                    {
                      name: productName,
                      category: category,
                      description: description,
                      price: parseInt(price),
                      image: productImage
                        ? e.target.result
                        : document.querySelector(
                            `img[data-id="${editProductId}"]`
                          ).src,
                    }
                  );
                  editProductId = null;
                  document.getElementById("submitButton").textContent =
                    "Submit";
                } else {
                  await axios.post("http://localhost:3000/products", {
                    name: productName,
                    category: category,
                    description: description,
                    price: parseInt(price),
                    image: e.target.result,
                  });
                }

                loadProducts();
                document.getElementById("productForm").reset();
              } catch (error) {
                console.error("Error adding/editing product:", error);
              }
            };

            if (productImage) {
              reader.readAsDataURL(productImage);
            } else {
              reader.onload({
                target: {
                  result: document.querySelector(
                    `img[data-id="${editProductId}"]`
                  ).src,
                },
              });
            }
          }
        });

      document.addEventListener("DOMContentLoaded", async function () {
        try {
          const response = await axios.get("http://localhost:3000/categories");
          const categories = response.data;

          const categorySelect = document.getElementById("category");
          categories.forEach((category) => {
            const option = document.createElement("option");
            option.value = category.code;
            option.textContent = category.name;
            categorySelect.appendChild(option);
          });

          loadProducts();
        } catch (error) {
          console.error("Error loading categories:", error);
        }

        document
          .getElementById("addCategoryBtn")
          .addEventListener("click", function () {
            window.location.href = "category.html";
          });
      });

      async function loadProducts() {
        try {
          const response = await axios.get("http://localhost:3000/products");
          const products = response.data;
          const productTableBody = document.getElementById("productTableBody");
          productTableBody.innerHTML = "";

          products.forEach((product) => {
            const row = document.createElement("tr");

            const nameCell = document.createElement("td");
            nameCell.className =
              "py-2 px-4 border-b border-gray-200 sm:whitespace-nowrap";
            nameCell.textContent = product.name;
            row.appendChild(nameCell);

            const categoryCell = document.createElement("td");
            categoryCell.className =
              "py-2 px-4 border-b border-gray-200 sm:whitespace-nowrap";
            categoryCell.textContent = product.category;
            row.appendChild(categoryCell);

            const descriptionCell = document.createElement("td");
            descriptionCell.className =
              "py-2 px-4 border-b border-gray-200 sm:whitespace-nowrap";
            descriptionCell.textContent = product.description;
            row.appendChild(descriptionCell);

            const priceCell = document.createElement("td");
            priceCell.className =
              "py-2 px-4 border-b border-gray-200 sm:whitespace-nowrap";
            priceCell.textContent = product.price;
            row.appendChild(priceCell);

            const imageCell = document.createElement("td");
            imageCell.className =
              "py-2 px-4 border-b border-gray-200 sm:whitespace-nowrap";
            const img = document.createElement("img");
            img.src = product.image;
            img.alt = product.name;
            img.className = "w-24 h-24 object-contain";
            img.dataset.id = product.id; // Add data-id attribute to image
            imageCell.appendChild(img);
            row.appendChild(imageCell);

            const actionCell = document.createElement("td");
            actionCell.className =
              "py-2 px-4 border-b border-gray-200 sm:whitespace-nowrap";
            const editButton = document.createElement("button");
            editButton.className =
              "bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2";
            editButton.textContent = "Edit";
            editButton.addEventListener("click", function () {
              editProductId = product.id;
              document.getElementById("productName").value = product.name;
              document.getElementById("category").value = product.category;
              document.getElementById("description").value =
                product.description;
              document.getElementById("price").value = product.price;
              document.getElementById("productImage").required = false;
              document.getElementById("submitButton").textContent = "Simpan";
            });
            actionCell.appendChild(editButton);

            const deleteButton = document.createElement("button");
            deleteButton.className =
              "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline";
            deleteButton.textContent = "Delete";
            deleteButton.addEventListener("click", async function () {
              try {
                await axios.delete(
                  `http://localhost:3000/products/${product.id}`
                );
                loadProducts();
              } catch (error) {
                console.error("Error deleting product:", error);
              }
            });
            actionCell.appendChild(deleteButton);

            row.appendChild(actionCell);
            productTableBody.appendChild(row);
          });
        } catch (error) {
          console.error("Error loading products:", error);
        }
      }
    </script>
  </body>
</html>
